# week1 
杨博欣：由于期末考等因素，本周暂时只完成实验环境的配置，后续将根据现有最新研究工作，确定我们的优化目标和优化思路。

汪旭：由于本周为考试周，暂时只完成实验环境的配置，通过阅读实验的背景资料，了解了FUSE文件系统的工作方式。



7/11


通过对F2FS的了解得知，F2FS是一个Log-structured File System(LFS)，因此会使用异地更新策略。假设有一个文件，它的文件数据保存在物理地址100的位置中，此时用户对文件内容进行更新:
非LFS: 使用就地更新策略，将更新后的数据写入到物理地址100中。
LFS: 使用异地更新策略，首先会分配一个新的物理地址101，然后将数据写入新物理地址101中，接着将文件指针指向新的物理地址101，最后将旧的物理地址100进行回收再利用。
这种设计的好处是:
可以将随机写转换为顺序写以获得更好的性能提升;
flash的颗粒program寿命是有限的，通过LFS的异地更新特性，可以自带磨损均衡。
但是LFS也有一些缺点，一个最明显的缺点是F2FS要对旧的物理地址进行回收，这个过程称为垃圾回收过程(GC)，不适当的GC时机会影响到系统的性能表现，而这也是我们打算进行优化的影响因素；另外一个缺点是LFS极端情况的安全性不像JFS(journal file system)那么好，因为LFS依赖Checkpoint保证一致性，但是Checkpoint不是每次写入数据都会进行(带来很大的开销)，而是隔一段时间才会进行一次Checkpoint，因此可能在Checkpoint之前系统宕机，会带来部分数据的丢失。

在F2FS中，冷热数据分区。其规则是：Node比Data热，在Node中，目录文件下的Direct Node为Hot、File文件下的Direct Node为Warm、Indirect Node为Cold；Data中，Dirent为Hot、普通Data Block为Warm、被回收的、用户指定的、多媒体数据文件等为Cold。这种分类较为简单，这也是我们可能在实际应用环境中取得进展的地方。同时F2FS使用NAT减少更新传播（update propagation），所有Node通过NAT（Node Address Table） 翻译。

不像LFS只有一个大的log区域，F2FS维护了六个主要的log区域来最大化冷热数据分区效应。F2FS静态地为Node Block和Data Block定义了3个数据温度级别——hot、warm以及cold。F2FS默认开启6个Log区域。同样也支持2、4个Log区域。当6个区域都被激活时，6个区域对应上表的6种温度级别的Block；当4个区域被激活时，F2FS将Cold和Warm Log区域合并在一起。如果只有2个Log区域，那么F2FS将一个区域分配给Node Block，一个区域分配给Data Block。
F2FS提供了一种Zone可定制FTL兼容方法，能够间接减轻GC开销。具体原理不太清楚

在我的理解中，冷热数据分离的原因应该是基于性能和磨损平衡两个方面的考量，热数据可以挪动。
有人提出对操作系统触发的写入和垃圾收集算法触发的写入使用不同块的写入方法。这些方法不需要数据识别技术，从而简化了设备的设计，同时也减少了写入放大。
使用平均场模型和模拟实验比较这种写入方法与依赖冷热数据识别的写入方法的性能。主要发现是识别热数据和冷数据的额外收益非常有限，尤其是当热数据变得更热时。此外，如果标记为热的数据的比例没有理想地选择，或者在识别数据时出现误报或误报的可能性很大（例如 5%），则依赖于热数据和冷数据识别的写入方法甚至可能会变得很差。在识别这个方面，我们在本次研究中也会考虑对其优化的可行性。

明天计划了解F2FS垃圾回收具体机制并对其源码进行分析。
